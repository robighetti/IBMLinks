import FakeLinksRepository from '../repositories/fakes/FakeLinksRepository';
import LoadLinksFromHtmlService from './LoadLinksFromHtmlService';

let loadLinksFromHtml: LoadLinksFromHtmlService;

describe('LoadLinksFromHtmlService', () => {
  beforeEach(() => {
    loadLinksFromHtml = new LoadLinksFromHtmlService();
  });

  it('should be able to return html from url', async () => {
    const html = `
      <!DOCTYPE html> <html> <head lang="pt-br"> <link rel="dns-prefetch" href="//conteudo.jsuol.com.br"> <link rel="dns-prefetch" href="//stc.uol.com"> <link rel="dns-prefetch" href="//conteudo.imguol.com.br"> <link rel="dns-prefetch" href="//conteudo.imguol.com.br"> <link rel="dns-prefetch" href="//conteudo.imguol.com.br"> <link rel="dns-prefetch" href="//e.imguol.com"> <link rel="dns-prefetch" href="//click.uol.com.br"> <link rel="dns-prefetch" href="//smetrics.uol.com.br"> <link rel="dns-prefetch" href="//securepubads.g.doubleclick.net"> <link rel="dns-prefetch" href="//www.googletagservices.com"> <link rel="dns-prefetch" href="//tt-10162-1.seg.t.tailtarget.com"> <link rel="dns-prefetch" href="//tm.uol.com.br"> <link rel="dns-prefetch" href="//tm.jsuol.com.br"> <link rel="dns-prefetch" href="//notify.uol.com.br"> <link rel="dns-prefetch" href="//widget.perfil.uol.com.br"> <link rel="dns-prefetch" href="//n.comentarios.uol.com.br"> <link rel="dns-prefetch" href="//view.comentarios.uol.com.br"> <link rel="dns-prefetch" href="//tagpage.uol.com.br"> <link rel="dns-prefetch" href="//mais.uol.com.br"> <link rel="dns-prefetch" href="//tracker.bt.uol.com.br"> <link rel="dns-prefetch" href="//dna.uol.com.br"> <link rel="dns-prefetch" href="//logger.rm.uol.com.br"> <link rel="dns-prefetch" href="//static.chartbeat.com"> <link rel="dns-prefetch" href="//mab.chartbeat.com"> <link rel="dns-prefetch" href="//ping.chartbeat.net"> <meta charset="utf-8"> <meta name="viewport" content="width=1210, user-scalable=yes"> <meta name="description" content="UOL, a maior empresa brasileira de conteúdo, serviços digitais e tecnologia com vários canais de jornalismo e diversas soluções para você ou seu negócio."> <meta name="keywords" content="esporte, jornais, revistas, biblioteca, folha online, folha.com, classificados, compras, computador, corpo, saúde, moda, carros, cinema, crianças, diversão, arte, economia, educação, internet, jogos, novelas, rádio, tv, tempo, mapas, trânsito, últimas notícias, viagem, jornalismo, informação, notícia, cultura, entretenimento, lazer, opinião, análise, internet, televisão, fotografia, imagem, som, áudio, vídeo, fotos, tecnologia, gay, vestibular, empregos, humor, música"> <meta name="google" content="nositelinkssearchbox"/> <meta property="og:title" content="UOL - O melhor conteúdo"/> <meta property="og:description" content="UOL, a maior empresa brasileira de conteúdo, serviços digitais e tecnologia com vários canais de jornalismo e diversas soluções para você ou seu negócio."/> <meta property="og:image" content="https://conteudo.imguol.com.br/c/home/interacao/facebook/logo-uol.png"/> <meta name="verify-v1" content="7hnfP9bNRwZQOBus6ORxqoE6FoPXYHjaWsqnn1nBWWY="> <meta name="google-site-verification" content="IM4UTOA_A-H54K9s-NNC_nKSthf02NbBKNtd7DZF6Cs"/> <meta name="google-site-verification" content="uPoEEmwsmGUXmhtQSbPK1DFcI9TNUZB19rqvpshC4vw"/> <meta name="p:domain_verify" content="3773adcdaf781c767a0dca14277f9101"/> <meta name="google-site-verification" content="sslvvQFHqQpykrmya7fdWX3KLh5kmR3YMLndZcpj0As"/> <meta name="googlebot" content="noodp"> <meta name="robots" content="index, follow"> <meta name="SKYPE_TOOLBAR" content="SKYPE_TOOLBAR_PARSER_COMPATIBLE"> <link rel="canonical" href="https://www.uol.com.br"> <meta name="referrer" content="always"> <meta name="application-name" content="UOL"> <meta name="msapplication-starturl" content="http://click.uol.com.br/?rf=msapp-home&amp;u=http://uol.com.br/"> <meta name="msapplication-navbutton-color" content="#194C7F"> <meta name="msapplication-tooltip" content="UOL"> <meta name="msapplication-task" content="name=Notícias;action-uri=http://click.uol.com.br/?rf=msapp-home-noticias&amp;u=http://noticias.uol.com.br/; icon-uri=//conteudo.imguol.com.br/c/home/layout/camaleao/web/gerais/favicon.ico; window=self"> <meta name="msapplication-task" content="name=Entretenimento;action-uri=http://click.uol.com.br/?rf=msapp-home-entretenimento&amp;u=http://entretenimento.uol.com.br/; icon-uri=//conteudo.imguol.com.br/c/home/layout/camaleao/web/gerais/favicon.ico; window=self"> <meta name="msapplication-task" content="name=Esporte;action-uri=http://click.uol.com.br/?rf=msapp-home-esporte&amp;uhttp://esporte.uol.com.br/; icon-uri=//conteudo.imguol.com.br/c/home/layout/camaleao/web/gerais/favicon.ico; window=self"> <meta name="google-site-verification" content="FnW8-QBChQFE3472oC-1yf785lHXh7UwM6rVwpLOtrI"/> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/> <meta http-equiv="refresh" content="18000"/> <noscript> <meta http-equiv="refresh" content="250"/> </noscript> <script type="text/javascript">var TIME_TO_RELOAD=4.1667*60*1000;window.cacheId="1eevj8c5a";window.universal_variable=window.universal_variable||{};window.universal_variable.sc=window.universal_variable.sc||{};window.universal_variable.sc.components=window.universal_variable.sc.components||[];universal_variable.sc.components=["widget-notificacoes-"+(document.cookie.match(/widget-notificacao/g)?"":"des")+"logado"];var inHeadTS=(new Date()).getTime();var _sf_startpt=(new Date()).getTime();</script> <title>UOL - O melhor conteúdo</title> <link rel="alternate" title="Home UOL - RSS" href="http://rss.home.uol.com.br/index.xml" type="application/rss+xml"/> <link rel="SHORTCUT ICON" href="https://conteudo.imguol.com.br/c/home/layout/camaleao/web/gerais/favicon.ico"/> <link rel="apple-touch-icon" href="https://conteudo.imguol.com.br/c/home/layout/camaleao/web/gerais/icon-touch.png"/> <script type="text/javascript">var serverDate={"day":"05","month":"08","year":"2020","hour":"16","minute":"10","second":0};var detectingAdblocks=true;var commentsCounter={"data":[{"url":"http://tvefamosos.uol.com.br/bbb/bbb16/noticias/redacao/2016/04/06/ana-paula-banca-festa-e-brothers-comemoram-separados-o-fim-do-bbb16.htm","qtd":"292","comments":"180","replies":"112"}]};var serviceStatus={"loadHotjar":false,"expRecommendation":false,"loginEnqueteBBB":true,"seeLater":true,"debug":false,"instrucaoEmailModal":true,"share":true,"countModules":true,"widgetProfile":true,"debugGA":false,"_uolabCTD006":false,"activeDialogSeeLater":false,"chromeAlerts":true,"_uolabteste8":false,"loadTagmanager":true,"emailModal":true,"googleFundingChoises":true,"loadChartbeat":true,"expTailTargetReorder":false,"showCounter":false,"virtualDom":true,"loadMetrics":true,"loadPingdom":false,"uol_app":false,"widgetCotacao":true,"woutBanner":false,"moduleMovAdvertisingLoad":true,"arquivoHome":false,"impressaoSeguir":false,"expReorder":false,"contentJS":false,"moduleMovMobilePaused":true,"widgetTempo":true,"widgetTailtarget":true,"_uolabteste10":false,"stopVideoAuto":true,"widgetNotificacao":true,"widgetLoteria":true,"mobile":false};(function(){if("-ms-scroll-limit" in document.documentElement.style&&"-ms-ime-align" in document.documentElement.style){if("NodeList" in window&&!NodeList.prototype.forEach){console.info("polyfill for IE11");NodeList.prototype.forEach=function(callback,thisArg){thisArg=thisArg||window;for(var i=0;i<this.length;i++){callback.call(thisArg,this[i],i,this);}};}if(!Array.prototype.forEach){Array.prototype.forEach=function forEach(callback,thisArg){if(typeof callback!=="function"){throw new TypeError(callback+" is not a function");}var array=this;thisArg=thisArg||this;for(var i=0,l=array.length;i!==l;++i){callback.call(thisArg,array[i],i,array);}};}if("HTMLElement" in window&&!HTMLElement.prototype.scrollTo){HTMLElement.prototype.scrollTo=function(left,top){this.scrollTop=top;this.scrollLeft=left;};}console.info("Polyfill IntersectionObserver for IE 11");!function(){if("object"==typeof window){if("IntersectionObserver" in window&&"IntersectionObserverEntry" in window&&"intersectionRatio" in window.IntersectionObserverEntry.prototype){"isIntersecting" in window.IntersectionObserverEntry.prototype||Object.defineProperty(window.IntersectionObserverEntry.prototype,"isIntersecting",{get:function(){return this.intersectionRatio>0;}});}else{var t=window.document,e=[];o.prototype.THROTTLE_TIMEOUT=100,o.prototype.POLL_INTERVAL=null,o.prototype.USE_MUTATION_OBSERVER=!0,o.prototype.observe=function(t){if(!this._observationTargets.some(function(e){return e.element==t;})){if(!t||1!=t.nodeType){throw new Error("target must be an Element");}this._registerInstance(),this._observationTargets.push({element:t,entry:null}),this._monitorIntersections(),this._checkForIntersections();}},o.prototype.unobserve=function(t){this._observationTargets=this._observationTargets.filter(function(e){return e.element!=t;}),this._observationTargets.length||(this._unmonitorIntersections(),this._unregisterInstance());},o.prototype.disconnect=function(){this._observationTargets=[],this._unmonitorIntersections(),this._unregisterInstance();},o.prototype.takeRecords=function(){var t=this._queuedEntries.slice();return this._queuedEntries=[],t;},o.prototype._initThresholds=function(t){var e=t||[0];return Array.isArray(e)||(e=[e]),e.sort().filter(function(t,e,n){if("number"!=typeof t||isNaN(t)||t<0||t>1){throw new Error("threshold must be a number between 0 and 1 inclusively");}return t!==n[e-1];});},o.prototype._parseRootMargin=function(t){var e=(t||"0px").split(/\s+/).map(function(t){var e=/^(-?\d*\.?\d+)(px|%)$/.exec(t);if(!e){throw new Error("rootMargin must be specified in pixels or percent");}return{value:parseFloat(e[1]),unit:e[2]};});return e[1]=e[1]||e[0],e[2]=e[2]||e[0],e[3]=e[3]||e[1],e;},o.prototype._monitorIntersections=function(){this._monitoringIntersections||(this._monitoringIntersections=!0,this.POLL_INTERVAL?this._monitoringInterval=setInterval(this._checkForIntersections,this.POLL_INTERVAL):(i(window,"resize",this._checkForIntersections,!0),i(t,"scroll",this._checkForIntersections,!0),this.USE_MUTATION_OBSERVER&&"MutationObserver" in window&&(this._domObserver=new MutationObserver(this._checkForIntersections),this._domObserver.observe(t,{attributes:!0,childList:!0,characterData:!0,subtree:!0}))));},o.prototype._unmonitorIntersections=function(){this._monitoringIntersections&&(this._monitoringIntersections=!1,clearInterval(this._monitoringInterval),this._monitoringInterval=null,r(window,"resize",this._checkForIntersections,!0),r(t,"scroll",this._checkForIntersections,!0),this._domObserver&&(this._domObserver.disconnect(),this._domObserver=null));},o.prototype._checkForIntersections=function(){var t=this._rootIsInDom(),e=t?this._getRootRect():{top:0,bottom:0,left:0,right:0,width:0,height:0};this._observationTargets.forEach(function(o){var i=o.element,r=s(i),h=this._rootContainsTarget(i),c=o.entry,a=t&&h&&this._computeTargetAndRootIntersection(i,e),u=o.entry=new n({time:window.performance&&performance.now&&performance.now(),target:i,boundingClientRect:r,rootBounds:e,intersectionRect:a});c?t&&h?this._hasCrossedThreshold(c,u)&&this._queuedEntries.push(u):c&&c.isIntersecting&&this._queuedEntries.push(u):this._queuedEntries.push(u);},this),this._queuedEntries.length&&this._callback(this.takeRecords(),this);},o.prototype._computeTargetAndRootIntersection=function(e,n){if("none"!=window.getComputedStyle(e).display){for(var o,i,r,h,a,u,d,l,p=s(e),f=c(e),g=!1;!g;){var _=null,v=1==f.nodeType?window.getComputedStyle(f):{};if("none"==v.display){return;}if(f==this.root||f==t?(g=!0,_=n):f!=t.body&&f!=t.documentElement&&"visible"!=v.overflow&&(_=s(f)),_&&(o=_,i=p,r=void 0,h=void 0,a=void 0,u=void 0,d=void 0,l=void 0,r=Math.max(o.top,i.top),h=Math.min(o.bottom,i.bottom),a=Math.max(o.left,i.left),u=Math.min(o.right,i.right),l=h-r,!(p=(d=u-a)>=0&&l>=0&&{top:r,bottom:h,left:a,right:u,width:d,height:l}))){break;}f=c(f);}return p;}},o.prototype._getRootRect=function(){var e;if(this.root){e=s(this.root);}else{var n=t.documentElement,o=t.body;e={top:0,left:0,right:n.clientWidth||o.clientWidth,width:n.clientWidth||o.clientWidth,bottom:n.clientHeight||o.clientHeight,height:n.clientHeight||o.clientHeight};}return this._expandRectByRootMargin(e);},o.prototype._expandRectByRootMargin=function(t){var e=this._rootMarginValues.map(function(e,n){return"px"==e.unit?e.value:e.value*(n%2?t.width:t.height)/100;}),n={top:t.top-e[0],right:t.right+e[1],bottom:t.bottom+e[2],left:t.left-e[3]};return n.width=n.right-n.left,n.height=n.bottom-n.top,n;},o.prototype._hasCrossedThreshold=function(t,e){var n=t&&t.isIntersecting?t.intersectionRatio||0:-1,o=e.isIntersecting?e.intersectionRatio||0:-1;if(n!==o){for(var i=0;i<this.thresholds.length;i++){var r=this.thresholds[i];if(r==n||r==o||r<n!=r<o){return !0;}}}},o.prototype._rootIsInDom=function(){return !this.root||h(t,this.root);},o.prototype._rootContainsTarget=function(e){return h(this.root||t,e);},o.prototype._registerInstance=function(){e.indexOf(this)<0&&e.push(this);},o.prototype._unregisterInstance=function(){var t=e.indexOf(this);-1!=t&&e.splice(t,1);},window.IntersectionObserver=o,window.IntersectionObserverEntry=n;}}function n(t){this.time=t.time,this.target=t.target,this.rootBounds=t.rootBounds,this.boundingClientRect=t.boundingClientRect,this.intersectionRect=t.intersectionRect||{top:0,bottom:0,left:0,right:0,width:0,height:0},this.isIntersecting=!!t.intersectionRect;var e=this.boundingClientRect,n=e.width*e.height,o=this.intersectionRect,i=o.width*o.height;this.intersectionRatio=n?Number((i/n).toFixed(4)):this.isIntersecting?1:0;}function o(t,e){var n,o,i,r=e||{};if("function"!=typeof t){throw new Error("callback must be a function");}if(r.root&&1!=r.root.nodeType){throw new Error("root must be an Element");}this._checkForIntersections=(n=this._checkForIntersections.bind(this),o=this.THROTTLE_TIMEOUT,i=null,function(){i||(i=setTimeout(function(){n(),i=null;},o));}),this._callback=t,this._observationTargets=[],this._queuedEntries=[],this._rootMarginValues=this._parseRootMargin(r.rootMargin),this.thresholds=this._initThresholds(r.threshold),this.root=r.root||null,this.rootMargin=this._rootMarginValues.map(function(t){return t.value+t.unit;}).join(" ");}function i(t,e,n,o){"function"==typeof t.addEventListener?t.addEventListener(e,n,o||!1):"function"==typeof t.attachEvent&&t.attachEvent("on"+e,n);}function r(t,e,n,o){"function"==typeof t.removeEventListener?t.removeEventListener(e,n,o||!1):"function"==typeof t.detatchEvent&&t.detatchEvent("on"+e,n);}function s(t){var e;try{e=t.getBoundingClientRect();}catch(t){}return e?(e.width&&e.height||(e={top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.right-e.left,height:e.bottom-e.top}),e):{top:0,bottom:0,left:0,right:0,width:0,height:0};}function h(t,e){for(var n=e;n;){if(n==t){return !0;}n=c(n);}return !1;}function c(t){var e=t.parentNode;return e&&11==e.nodeType&&e.host?e.host:e&&e.assignedSlot?e.assignedSlot.parentNode:e;}}();}if(!Element.prototype.matches){Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;}if(!Element.prototype.closest){Element.prototype.closest=function(s){var el=this;if(!document.documentElement.contains(el)){return null;}do{if(el.matches(s)){return el;}el=el.parentElement;}while(el!==null);return null;};}})();
    `;

    const links = await loadLinksFromHtml.execute(html);

    expect(links).toBeInstanceOf(Array);
  });
});
